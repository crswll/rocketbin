var s,d=document,editor=ace.edit("editor"),app={settings:{lang:"html",theme:"github",keybinding:"none",optionLanguage:d.getElementById("language"),optionTheme:d.getElementById("theme"),optionKeybinding:d.getElementById("keybinding"),form:d.getElementById("form-save-code"),btnDelete:$(".btnDelete")},init:function(){s=this.settings,this.setDefaultOptions(),this.bindUI()},bindUI:function(){s.optionLanguage.addEventListener("change",app.changeLang),s.optionKeybinding.addEventListener("change",app.changeKeybinding),s.form.addEventListener("submit",app.saveCode)},setKeybinding:function(e){editor.setKeyboardHandler("ace/keyboard/"+e)},setDefaultOptions:function(){ace.require("ace/ext/language_tools"),ace.require("ace/ext/emmet"),editor.setOption("EnableEmmet",!0),this.setTheme(s.theme),this.setLang(s.lang),editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,behavioursEnabled:!0})},setLang:function(e){"html"!=e?editor.setOption("enableEmmet",!1):editor.setOption("enableEmmet",!0),editor.getSession().setMode("ace/mode/"+e)},setTheme:function(e){editor.setTheme("ace/theme/"+e)},changeKeybinding:function(){value=this.value,s.keybinding=value,app.setKeybinding(value)},changeLang:function(){value=this.value,s.lang=value,app.setLang(value)},changeTheme:function(){value=this.value,s.theme=value,app.setTheme(value)},deleteCode:function(e){e.preventDefault();var t=$(this);console.log(t)},saveCode:function(e){e.preventDefault();var t=editor.getValue();""!=t&&$.ajax({url:"/paste/save",data:{code:t,lang:s.lang,theme:s.theme},type:"POST",success:function(e){var t=$.parseJSON(e);t._id&&(location.href=location.href+"paste/"+t._id)},error:function(e){console.dir(e),console.log("something happened")}})}};app.init();